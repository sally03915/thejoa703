axios.js , index.js, src/pages/OAuth2Callback.js   íŒŒì¼ì„ CSR(Client Side Rendering) + SSR(Server Side Rendering) ëª¨ë‘ ì§€ì›í•˜ëŠ” Axios ì„¤ì •ê°€ëŠ¥í•˜ê²Œ  springbootì—ì„œ ì„¤ì •í•œë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ê°€ ë° ìˆ˜ì •ë³´ì™„í•´ì„œ importì™€ ì£¼ì„ì„ ë‹¬ì•„ ì „ì²´ì½”ë“œ ë¶€íƒí•´....... ê·¸ë¦¬ê³  ì•„ë˜ ë‚´ìš© ë§ëŠ”ì§€ë„ ë‹¤ì‹œ ì ê²€í•´ì¤˜ 

í•µì‹¬ì€:
1. Refresh Tokenì€ HttpOnly ì¿ í‚¤ì— ì €ì¥ â†’ JS ì ‘ê·¼ ë¶ˆê°€, Axiosê°€ ìë™ í¬í•¨ (withCredentials: true).
2. Access Tokenì€ CSRì—ì„œëŠ” localStorage/ì¿ í‚¤ì— ì €ì¥, SSRì—ì„œëŠ” ì„œë²„ì—ì„œ req.cookiesë¥¼ ì½ì–´ ì²˜ë¦¬.
3. Axios ì¸í„°ì…‰í„°ë¡œ 401 ë°œìƒ ì‹œ /auth/refresh



---

### í•µì‹¬ 3ê°€ì§€ ë‹¤ì‹œ ì ê²€

1. Refresh Tokenì€ HttpOnly ì¿ í‚¤ì— ì €ì¥ â†’ JS ì ‘ê·¼ ë¶ˆê°€, Axiosê°€ ìë™ í¬í•¨(withCredentials: true).  
   - axios ì¸ìŠ¤í„´ìŠ¤ì—ì„œ withCredentials: true ì„¤ì • OK.
   - í”„ë¡ íŠ¸ ì½”ë“œì—ì„œ Refresh Tokenì„ ì§ì ‘ ê±´ë“œë¦¬ì§€ ì•ŠìŒ OK.

2. Access Tokenì€ CSRì—ì„œëŠ” localStorage/ì¿ í‚¤ì— ì €ì¥, SSRì—ì„œëŠ” ì„œë²„ì—ì„œ req.cookiesë¥¼ ì½ì–´ ì²˜ë¦¬.  
   - CSR: OAuth2Callback, ë¡œê·¸ì¸ ë¡œì§ì—ì„œ localStorage ì €ì¥ OK.  
   - SSR: getServerSidePropsì—ì„œ req.headers.cookieë¥¼ ì „ë‹¬, /auth/meë¡œ ì¸ì¦ í™•ì¸ OK.

3. Axios ì¸í„°ì…‰í„°ë¡œ 401 ë°œìƒ ì‹œ /auth/refresh.  
   - lib/axios.js ì‘ë‹µ ì¸í„°ì…‰í„°ì—ì„œ 401 ì²˜ë¦¬ â†’ /auth/refresh í˜¸ì¶œ â†’ ìƒˆ Access Token ì €ì¥ í›„ ì› ìš”ì²­ ì¬ì‹œë„ OK.
 

 
////////////////////////////////////////////////////
 

# Redux auth reducer and saga with csr+ssr token flow
 

- ë¡œê·¸ì¸ ì‘ë‹µì€ `{ accessToken, user }` êµ¬ì¡°ì— ë§ê²Œ ì²˜ë¦¬.
- ì¬ë°œê¸‰ ì‘ë‹µì€ `{ accessToken }`ë§Œ ë°˜í™˜í•˜ë¯€ë¡œ ì •í™•íˆ ë°˜ì˜.
- Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ê´€ë¦¬ë˜ë¯€ë¡œ í”„ë¡ íŠ¸ ìƒíƒœì— ì €ì¥í•˜ì§€ ì•ŠìŒ.
- íŒŒì¼ ì—…ë¡œë“œ í•„ë“œëª…ì€ ë°±ì—”ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ `@RequestParam("ufile")`ì— ë§ê²Œ `ufile`ë¡œ ì „ì†¡.
- CSRì—ì„œë§Œ `localStorage`/`js-cookie` ì ‘ê·¼, SSR ì•ˆì „í•˜ê²Œ ë¶„ê¸° ì²˜ë¦¬.
- ë¡œê·¸ì•„ì›ƒ ì‹œ ë¡œì»¬ Access Token ì œê±°.

---

## reducers/authReducer.js

```javascript
// reducers/authReducer.js
// - Spring Boot ì‘ë‹µ í˜•íƒœì— ë§ì¶˜ ì¸ì¦ ë¦¬ë“€ì„œ
// - Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ê´€ë¦¬ë˜ë¯€ë¡œ ìƒíƒœì— ì €ì¥í•˜ì§€ ì•ŠìŒ
// - Access Tokenì€ CSRì—ì„œë§Œ localStorage/ì¿ í‚¤ë¡œ ê´€ë¦¬í•˜ë˜, ìƒíƒœì—ë„ ì„ íƒì ìœ¼ë¡œ ë°˜ì˜

import { createSlice } from "@reduxjs/toolkit";

const initialState = {
  // âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´
  // { id, email, nickname, provider, role, ... }
  user: null,

  // âœ… ì„ íƒ: CSRì—ì„œë§Œ ë™ê¸°í™”ìš©ìœ¼ë¡œ ìœ ì§€ (SSRì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
  accessToken: null,

  loading: false,
  error: null,
  success: false,
};

const authSlice = createSlice({
  name: "auth",
  initialState,
  reducers: {
    // --- íšŒì›ê°€ì… ---
    signupRequest: (state) => {
      state.loading = true;
      state.error = null;
      state.success = false;
    },
    signupSuccess: (state) => {
      state.loading = false;
      state.success = true;
    },
    signupFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },

    // --- ë¡œê·¸ì¸ ---
    loginRequest: (state) => {
      state.loading = true;
      state.error = null;
    },
    loginSuccess: (state, action) => {
      state.loading = false;
      // âœ… ì„œë²„ ì‘ë‹µ { user, accessToken } ë°˜ì˜
      state.user = action.payload.user || null;
      state.accessToken = action.payload.accessToken || null;
    },
    loginFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
      state.user = null;
      state.accessToken = null;
    },

    // --- í† í° ì¬ë°œê¸‰ ---
    refreshTokenRequest: (state) => {
      state.loading = true;
    },
    refreshTokenSuccess: (state, action) => {
      state.loading = false;
      // âœ… ìƒˆ Access Tokenë§Œ ìƒíƒœì— ë°˜ì˜ (ì„ íƒ)
      state.accessToken = action.payload?.accessToken || null;
    },
    refreshTokenFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },

    // --- ë¡œê·¸ì•„ì›ƒ ---
    logoutRequest: (state) => {
      state.loading = true;
    },
    logout: (state) => {
      state.loading = false;
      state.user = null;
      state.accessToken = null;
      state.error = null;
      state.success = false;
    },
    logoutFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },

    // --- ë‹‰ë„¤ì„ ë³€ê²½ ---
    updateNicknameRequest: (state) => {
      state.loading = true;
    },
    updateNicknameSuccess: (state, action) => {
      state.loading = false;
      // âœ… ë³€ê²½ëœ ì‚¬ìš©ì ì •ë³´ ë°˜ì˜
      state.user = action.payload.user;
    },
    updateNicknameFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },

    // --- í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ ---
    updateProfileImageRequest: (state) => {
      state.loading = true;
    },
    updateProfileImageSuccess: (state, action) => {
      state.loading = false;
      // âœ… ë³€ê²½ëœ ì‚¬ìš©ì ì •ë³´ ë°˜ì˜
      state.user = action.payload.user;
    },
    updateProfileImageFailure: (state, action) => {
      state.loading = false;
      state.error = action.payload;
    },
  },
});

export const {
  signupRequest,
  signupSuccess,
  signupFailure,
  loginRequest,
  loginSuccess,
  loginFailure,
  refreshTokenRequest,
  refreshTokenSuccess,
  refreshTokenFailure,
  logoutRequest,
  logout,
  logoutFailure,
  updateNicknameRequest,
  updateNicknameSuccess,
  updateNicknameFailure,
  updateProfileImageRequest,
  updateProfileImageSuccess,
  updateProfileImageFailure,
} = authSlice.actions;

export default authSlice.reducer;
```

---

## sagas/authSaga.js

```javascript
// sagas/authSaga.js
// - CSR + SSR ëª¨ë‘ ê³ ë ¤í•œ ì¸ì¦ ì‚¬ê°€
// - Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ìë™ í¬í•¨ (axios.withCredentials)
// - Access Tokenì€ CSRì—ì„œë§Œ localStorage/js-cookieë¡œ ì €ì¥/ê°±ì‹ 

import { call, put, takeLatest } from "redux-saga/effects";
import Cookies from "js-cookie"; // CSRì—ì„œë§Œ ì‚¬ìš©
import api from "../lib/axios";
import {
  signupRequest,
  signupSuccess,
  signupFailure,
  loginRequest,
  loginSuccess,
  loginFailure,
  refreshTokenRequest,
  refreshTokenSuccess,
  refreshTokenFailure,
  logoutRequest,
  logout,
  logoutFailure,
  updateNicknameRequest,
  updateNicknameSuccess,
  updateNicknameFailure,
  updateProfileImageRequest,
  updateProfileImageSuccess,
  updateProfileImageFailure,
} from "../reducers/authReducer";

// --- íšŒì›ê°€ì… API ---
function signupApi(formData) {
  return api.post("/auth/signup", formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
}
export function* signup(action) {
  try {
    yield call(signupApi, action.payload);
    yield put(signupSuccess());
  } catch (err) {
    yield put(signupFailure(err.response?.data?.error || err.message));
  }
}

// --- ë¡œê·¸ì¸ API ---
// Spring Boot: { accessToken, user } ë°˜í™˜ + Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ë‚´ë ¤ê°
function loginApi(payload) {
  return api.post("/auth/login", payload);
}
export function* login(action) {
  try {
    const { data } = yield call(loginApi, action.payload);
    const accessToken = data?.accessToken;
    const user = data?.user;

    if (user && accessToken) {
      // âœ… CSRì—ì„œë§Œ Access Token ì €ì¥
      if (typeof window !== "undefined") {
        localStorage.setItem("accessToken", accessToken);
        Cookies.set("accessToken", accessToken);
      }
      yield put(loginSuccess({ user, accessToken }));
    } else {
      yield put(loginFailure("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."));
    }
  } catch (err) {
    yield put(loginFailure(err.response?.data?.error || err.message));
  }
}

// --- í† í° ì¬ë°œê¸‰ API ---
// Spring Boot: { accessToken } ë°˜í™˜
function refreshApi() {
  return api.post("/auth/refresh");
}
export function* refresh() {
  try {
    const { data } = yield call(refreshApi);
    const newAccessToken = data?.accessToken || null;

    // âœ… CSR: ìƒˆ Access Token ì €ì¥
    if (typeof window !== "undefined" && newAccessToken) {
      localStorage.setItem("accessToken", newAccessToken);
      Cookies.set("accessToken", newAccessToken);
    }

    yield put(refreshTokenSuccess({ accessToken: newAccessToken }));
  } catch (err) {
    yield put(refreshTokenFailure(err.response?.data?.error || err.message));
  }
}

// --- ë¡œê·¸ì•„ì›ƒ API ---
// Spring Boot: Redis Refresh Token ì‚­ì œ + Refresh Token ì¿ í‚¤ ë§Œë£Œ
function logoutApi() {
  return api.post("/auth/logout");
}
export function* logoutFlow() {
  try {
    yield call(logoutApi);
    // âœ… CSR: Access Token ì œê±°
    if (typeof window !== "undefined") {
      localStorage.removeItem("accessToken");
      Cookies.remove("accessToken");
    }
    yield put(logout());
  } catch (err) {
    yield put(logoutFailure(err.response?.data?.error || err.message));
  }
}

// --- ë‹‰ë„¤ì„ ë³€ê²½ API ---
function updateNicknameApi({ userId, nickname }) {
  return api.patch(`/auth/${userId}/nickname`, null, {
    params: { nickname },
  });
}
export function* updateNickname(action) {
  try {
    const { data } = yield call(updateNicknameApi, action.payload);
    // âœ… ì„œë²„ê°€ ë³€ê²½ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤ê³  ê°€ì •
    yield put(updateNicknameSuccess({ user: data }));
  } catch (err) {
    yield put(updateNicknameFailure(err.response?.data?.error || err.message));
  }
}

// --- í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ API ---
// Spring Boot ì»¨íŠ¸ë¡¤ëŸ¬: @RequestParam("ufile") MultipartFile ufile
function updateProfileImageApi({ userId, file }) {
  const formData = new FormData();
  formData.append("ufile", file); // âœ… í•„ë“œëª… ufileë¡œ ë§ì¶¤
  return api.post(`/auth/${userId}/profile-image`, formData, {
    headers: { "Content-Type": "multipart/form-data" },
  });
}
export function* updateProfileImage(action) {
  try {
    const { data } = yield call(updateProfileImageApi, action.payload);
    // âœ… ì„œë²„ê°€ ë³€ê²½ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤ê³  ê°€ì •
    yield put(updateProfileImageSuccess({ user: data }));
  } catch (err) {
    yield put(updateProfileImageFailure(err.response?.data?.error || err.message));
  }
}

// --- Root Saga ---
export default function* authSaga() {
  yield takeLatest(signupRequest.type, signup);
  yield takeLatest(loginRequest.type, login);
  yield takeLatest(refreshTokenRequest.type, refresh);
  yield takeLatest(logoutRequest.type, logoutFlow);
  yield takeLatest(updateNicknameRequest.type, updateNickname);
  yield takeLatest(updateProfileImageRequest.type, updateProfileImage);
}
```
---

## ğŸ“Œ authReducer.test.js (ë¦¬ë“€ì„œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)

```javascript
// __tests__/authReducer.test.js
// âœ… authReducer ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
import reducer, {
  signupRequest, signupSuccess, signupFailure,
  loginRequest, loginSuccess, loginFailure,
  refreshTokenRequest, refreshTokenSuccess, refreshTokenFailure,
  logoutRequest, logout, logoutFailure,
  updateNicknameRequest, updateNicknameSuccess, updateNicknameFailure,
  updateProfileImageRequest, updateProfileImageSuccess, updateProfileImageFailure,
} from '../reducers/authReducer';

describe('auth reducer', () => {
  const initialState = {
    user: null,
    accessToken: null,
    loading: false,
    error: null,
    success: false,
  };

  // --- íšŒì›ê°€ì… ---
  it('handles signupRequest', () => {
    const state = reducer(initialState, signupRequest());
    expect(state.loading).toBe(true);
    expect(state.error).toBeNull();
    expect(state.success).toBe(false);
  });

  it('handles signupSuccess', () => {
    const state = reducer(initialState, signupSuccess());
    expect(state.success).toBe(true);
    expect(state.user).toBeNull();
    expect(state.loading).toBe(false);
  });

  it('handles signupFailure', () => {
    const state = reducer(initialState, signupFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.loading).toBe(false);
    expect(state.success).toBe(false);
  });

  // --- ë¡œê·¸ì¸ ---
  it('handles loginRequest', () => {
    const state = reducer(initialState, loginRequest());
    expect(state.loading).toBe(true);
  });

  it('handles loginSuccess', () => {
    const payload = { user: { id: 1, email: 'login@test.com' }, accessToken: 'ACCESS' };
    const state = reducer(initialState, loginSuccess(payload));
    expect(state.user).toEqual(payload.user);
    expect(state.accessToken).toBe('ACCESS');
    expect(state.loading).toBe(false);
  });

  it('handles loginFailure', () => {
    const state = reducer(initialState, loginFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.user).toBeNull();
    expect(state.loading).toBe(false);
  });

  // --- í† í° ì¬ë°œê¸‰ ---
  it('handles refreshTokenRequest', () => {
    const state = reducer(initialState, refreshTokenRequest());
    expect(state.loading).toBe(true);
  });

  it('handles refreshTokenSuccess', () => {
    const state = reducer(initialState, refreshTokenSuccess({ accessToken: 'ACCESS' }));
    expect(state.accessToken).toBe('ACCESS');
    expect(state.loading).toBe(false);
  });

  it('handles refreshTokenFailure', () => {
    const state = reducer(initialState, refreshTokenFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.loading).toBe(false);
  });

  // --- ë¡œê·¸ì•„ì›ƒ ---
  it('handles logoutRequest', () => {
    const state = reducer(initialState, logoutRequest());
    expect(state.loading).toBe(true);
  });

  it('handles logout', () => {
    const prev = { ...initialState, user: { id: 1 }, accessToken: 'A' };
    const state = reducer(prev, logout());
    expect(state.user).toBeNull();
    expect(state.accessToken).toBeNull();
    expect(state.loading).toBe(false);
  });

  it('handles logoutFailure', () => {
    const state = reducer(initialState, logoutFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.loading).toBe(false);
  });

  // --- ë‹‰ë„¤ì„ ë³€ê²½ ---
  it('handles updateNicknameRequest', () => {
    const state = reducer(initialState, updateNicknameRequest());
    expect(state.loading).toBe(true);
  });

  it('handles updateNicknameSuccess', () => {
    const state = reducer(initialState, updateNicknameSuccess({ user: { id: 1, nickname: 'ìƒˆë‹‰' } }));
    expect(state.user).toEqual({ id: 1, nickname: 'ìƒˆë‹‰' });
    expect(state.loading).toBe(false);
  });

  it('handles updateNicknameFailure', () => {
    const state = reducer(initialState, updateNicknameFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.loading).toBe(false);
  });

  // --- í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ ---
  it('handles updateProfileImageRequest', () => {
    const state = reducer(initialState, updateProfileImageRequest());
    expect(state.loading).toBe(true);
  });

  it('handles updateProfileImageSuccess', () => {
    const state = reducer(initialState, updateProfileImageSuccess({ user: { id: 1, ufile: 'url' } }));
    expect(state.user).toEqual({ id: 1, ufile: 'url' });
    expect(state.loading).toBe(false);
  });

  it('handles updateProfileImageFailure', () => {
    const state = reducer(initialState, updateProfileImageFailure('fail'));
    expect(state.error).toBe('fail');
    expect(state.loading).toBe(false);
  });
});
```
 
  
---

## ğŸ“Œ __tests__/authSaga.test.js

```javascript
// __tests__/authSaga.test.js
// âœ… authSaga ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (runSaga ì‚¬ìš©)
import { runSaga } from 'redux-saga';
import api from '../lib/axios'; // axios ì¸ìŠ¤í„´ìŠ¤ ëª¨í‚¹
import {
  signup, login, refresh, logoutFlow, updateNickname, updateProfileImage,
} from '../sagas/authSaga';
import {
  signupSuccess, signupFailure,
  loginSuccess, loginFailure,
  refreshTokenSuccess, refreshTokenFailure,
  logout, logoutFailure,
  updateNicknameSuccess, updateNicknameFailure,
  updateProfileImageSuccess, updateProfileImageFailure,
} from '../reducers/authReducer';

// axios ëª¨í‚¹
jest.mock('../lib/axios');

describe('auth saga', () => {
  afterEach(() => {
    jest.clearAllMocks();
  });

  // --- íšŒì›ê°€ì… ---
  it('signup success', async () => {
    api.post.mockResolvedValue({ data: {} });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, signup, { payload: {} }).toPromise();
    expect(dispatched).toContainEqual(signupSuccess());
  });

  it('signup failure', async () => {
    api.post.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, signup, { payload: {} }).toPromise();
    expect(dispatched).toContainEqual(signupFailure('fail'));
  });

  // --- ë¡œê·¸ì¸ ---
  it('login success', async () => {
    api.post.mockResolvedValue({ data: { user: { id: 1 }, accessToken: 'A' } });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, login, { payload: {} }).toPromise();
    expect(dispatched).toContainEqual(loginSuccess({ user: { id: 1 }, accessToken: 'A' }));
  });

  it('login failure', async () => {
    api.post.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, login, { payload: {} }).toPromise();
    expect(dispatched).toContainEqual(loginFailure('fail'));
  });

  // --- í† í° ì¬ë°œê¸‰ ---
  it('refresh success', async () => {
    api.post.mockResolvedValue({ data: { accessToken: 'NEW' } });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, refresh).toPromise();
    expect(dispatched).toContainEqual(refreshTokenSuccess({ accessToken: 'NEW' }));
  });

  it('refresh failure', async () => {
    api.post.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, refresh).toPromise();
    expect(dispatched).toContainEqual(refreshTokenFailure('fail'));
  });

  // --- ë¡œê·¸ì•„ì›ƒ ---
  it('logout success', async () => {
    api.post.mockResolvedValue({});
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, logoutFlow).toPromise();
    expect(dispatched).toContainEqual(logout());
  });

  it('logout failure', async () => {
    api.post.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga({ dispatch: (a) => dispatched.push(a) }, logoutFlow).toPromise();
    expect(dispatched).toContainEqual(logoutFailure('fail'));
  });

  // --- ë‹‰ë„¤ì„ ë³€ê²½ ---
  it('updateNickname success', async () => {
    api.patch.mockResolvedValue({ data: { id: 1, nickname: 'ìƒˆë‹‰' } });
    const dispatched = [];
    await runSaga(
      { dispatch: (a) => dispatched.push(a) },
      updateNickname,
      { payload: { userId: 1, nickname: 'ìƒˆë‹‰' } }
    ).toPromise();
    expect(dispatched).toContainEqual(updateNicknameSuccess({ user: { id: 1, nickname: 'ìƒˆë‹‰' } }));
  });

  it('updateNickname failure', async () => {
    api.patch.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga(
      { dispatch: (a) => dispatched.push(a) },
      updateNickname,
      { payload: { userId: 1, nickname: 'ìƒˆë‹‰' } }
    ).toPromise();
    expect(dispatched).toContainEqual(updateNicknameFailure('fail'));
  });

  // --- í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ ---
  it('updateProfileImage success', async () => {
    api.post.mockResolvedValue({ data: { id: 1, ufile: 'url' } });
    const dispatched = [];
    await runSaga(
      { dispatch: (a) => dispatched.push(a) },
      updateProfileImage,
      { payload: { userId: 1, file: new Blob(['test']) } }
    ).toPromise();
    expect(dispatched).toContainEqual(updateProfileImageSuccess({ user: { id: 1, ufile: 'url' } }));
  });

  it('updateProfileImage failure', async () => {
    api.post.mockRejectedValue({ message: 'fail' });
    const dispatched = [];
    await runSaga(
      { dispatch: (a) => dispatched.push(a) },
      updateProfileImage,
      { payload: { userId: 1, file: new Blob(['test']) } }
    ).toPromise();
    expect(dispatched).toContainEqual(updateProfileImageFailure('fail'));
  });
});
```
 



/////////////////////////////////////////////////// 
---

### Axios ì„¤ì •ê³¼ ì¸ì¦ íë¦„ ê°œìš”

- Refresh Token: ë°±ì—”ë“œê°€ HttpOnly ì¿ í‚¤ë¡œ ë°œê¸‰. JSì—ì„œ ì ‘ê·¼ ë¶ˆê°€. Axios withCredentialsê°€ ìë™ìœ¼ë¡œ í¬í•¨.
- Access Token: CSRì€ localStorage/ì¿ í‚¤ì—ì„œ ê´€ë¦¬, SSRì€ req.cookiesì—ì„œ ì½ì–´ í—¤ë”ì— ë¶™ì—¬ ì‚¬ìš©.
- 401 ì‹œ Axios ì‘ë‹µ ì¸í„°ì…‰í„°ê°€ /auth/refresh í˜¸ì¶œ â†’ ìƒˆ Access Token ì €ì¥ í›„ ì› ìš”ì²­ ì¬ì‹œë„.
- SSRì—ì„œëŠ” getServerSidePropsì—ì„œ /auth/me í˜¸ì¶œë¡œ ì¸ì¦ ê²€ì¦. ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸.

---

### 1) lib/axios.js

```javascript
// lib/axios.js
// ê³µìš© Axios ì¸ìŠ¤í„´ìŠ¤ (CSR + SSR)
// - Refresh Tokenì€ HttpOnly ì¿ í‚¤ë¡œ ìë™ í¬í•¨ (withCredentials)
// - CSR: Access Tokenì„ localStorage/js-cookieì—ì„œ ì½ì–´ Authorization í—¤ë”ë¡œ ì¶”ê°€
// - 401 ë°œìƒ ì‹œ /auth/refreshë¡œ ìë™ ì¬ë°œê¸‰ í›„ ì› ìš”ì²­ ì¬ì‹œë„

import axios from "axios";
import Cookies from "js-cookie"; // CSRì—ì„œë§Œ ì‚¬ìš©

const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_BASE_URL || "http://localhost:8484",
  withCredentials: true, // âœ… Refresh Token ì¿ í‚¤ ìë™ í¬í•¨
});

// âœ… ìš”ì²­ ì¸í„°ì…‰í„°
api.interceptors.request.use(
  (config) => {
    // CSR í™˜ê²½ì—ì„œë§Œ Access Tokenì„ ë¶™ì„
    if (typeof window !== "undefined") {
      const accessToken =
        localStorage.getItem("accessToken") || Cookies.get("accessToken");
      if (accessToken) {
        config.headers.Authorization = `Bearer ${accessToken}`;
      }
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// âœ… ì‘ë‹µ ì¸í„°ì…‰í„° (401 â†’ ìë™ ì¬ë°œê¸‰ â†’ ì¬ì‹œë„)
api.interceptors.response.use(
  (res) => res,
  async (error) => {
    const original = error.config;
    const status = error.response?.status;

    // í† í° ë§Œë£Œë¡œ ì¶”ì •ë˜ëŠ” 401ë§Œ ì²˜ë¦¬, ì¬ê·€ ë°©ì§€ í”Œë˜ê·¸
    if (status === 401 && !original._retry) {
      original._retry = true;
      try {
        // Refresh Tokenì€ ì¿ í‚¤ë¡œ ìë™ í¬í•¨ë¨
        const { data } = await api.post("/auth/refresh");
        const newAccessToken = data?.accessToken;

        // CSR: ìƒˆ í† í° ì €ì¥
        if (typeof window !== "undefined" && newAccessToken) {
          localStorage.setItem("accessToken", newAccessToken);
          Cookies.set("accessToken", newAccessToken);
        }

        // ì› ìš”ì²­ì— ìƒˆ í† í° ì ìš© í›„ ì¬ì‹œë„
        original.headers = {
          ...(original.headers || {}),
          Authorization: `Bearer ${newAccessToken}`,
        };
        return api(original);
      } catch (refreshErr) {
        // ì¬ë°œê¸‰ ì‹¤íŒ¨ â†’ CSRì—ì„œëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
        if (typeof window !== "undefined") {
          localStorage.removeItem("accessToken");
          Cookies.remove("accessToken");
          window.location.href = "/login";
        }
        return Promise.reject(refreshErr);
      }
    }

    return Promise.reject(error);
  }
);

export default api;
```

---

### 2) pages/index.js (í™ˆ, SSRì—ì„œ ì¸ì¦ ìƒíƒœ ë³µì›ë§Œ ì‹œë„)
 
---

## ğŸ“Œ ìˆ˜ì • ë°©ë²• 

```javascript
// pages/index.js
import React from "react";
import { useSelector } from "react-redux";
import { wrapper } from "../store/configureStore";
import { loginSuccess } from "../reducers/authReducer";
import api from "../api/axios";

export default function HomePage() {
  const { user } = useSelector((state) => state.auth);

  return (
    <div>
      <h1>í™ˆ</h1>
      {user && user.nickname ? (
        <p>{user.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</p>
      ) : (
        <p>ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
      )}
    </div>
  );
}

// âœ… SSR: ì¸ì¦ ì •ë³´ ìˆìœ¼ë©´ ë³µì›, ì—†ì–´ë„ í™ˆì€ ì ‘ê·¼ í—ˆìš©
export const getServerSideProps = wrapper.getServerSideProps((store) => async (ctx) => {
  const cookie = ctx.req.headers.cookie || "";
  try {
    const res = await api.get("/auth/me", { headers: { cookie } });
    if (res?.data && res.data.nickname) {
      store.dispatch(loginSuccess({ user: res.data }));
    }
  } catch {
    // í™ˆì—ì„œëŠ” ì‹¤íŒ¨í•´ë„ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ì§€ ì•ŠìŒ
  }
  return { props: {} };
});
```
 

---

### 3) pages/login.js (CSR ë¡œê·¸ì¸ ë¡œì§ ë³´ì™„)

```javascript
// pages/login.js
// ë¡œê·¸ì¸ í˜ì´ì§€: ë¡œê·¸ì¸ ìš”ì²­ í›„ Access Token ì €ì¥ â†’ /auth/meë¡œ ì‚¬ìš©ì ì •ë³´ ê°±ì‹  â†’ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
// SSRì—ì„œëŠ” ë‹¨ìˆœ ë Œë”ë§Œ ìˆ˜í–‰

import React from "react";
import { useDispatch, useSelector } from "react-redux";
import { Row, Col, Form, Input, Button, Spin, message } from "antd";
import { useRouter } from "next/router";
import { loginRequest, loginSuccess, logout } from "../reducers/authReducer";
import api from "../api/axios";

export default function LoginPage() {
  const dispatch = useDispatch();
  const router = useRouter();
  const { user, loading, error } = useSelector((state) => state.auth);

  const onFinish = async (values) => {
    try {
      // âœ… sagaë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°: loginRequestë§Œ dispatch
      dispatch(loginRequest({ ...values, provider: "local" }));

      // âœ… ì§ì ‘ í˜¸ì¶œ ì˜ˆì‹œ (saga ë¯¸ì‚¬ìš© ì‹œ)
      const me = await api.get("/auth/me");
      if (me?.data && me.data.nickname) {
        dispatch(loginSuccess({ user: me.data }));
        message.success(`${me.data.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
        router.push("/mypage");
      } else {
        dispatch(logout());
        message.error("ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      }
    } catch (err) {
      dispatch(logout());
      message.error("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
    }
  };

  return (
    <Row justify="center" style={{ marginTop: 40 }}>
      <Col xs={24} sm={16} md={8}>
        {loading && <Spin />}
        {error && <p style={{ color: "red" }}>{error}</p>}

        {!user || !user.nickname ? (
          <Form onFinish={onFinish}>
            <Form.Item
              name="email"
              rules={[{ required: true, message: "ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" }]}
            >
              <Input placeholder="ì´ë©”ì¼" />
            </Form.Item>
            <Form.Item
              name="password"
              rules={[{ required: true, message: "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" }]}
            >
              <Input.Password placeholder="ë¹„ë°€ë²ˆí˜¸" />
            </Form.Item>
            <Button type="primary" htmlType="submit" loading={loading}>
              ë¡œê·¸ì¸
            </Button>
          </Form>
        ) : (
          <p>{user.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</p>
        )}
      </Col>
    </Row>
  );
}

// SSRì—ì„œëŠ” ë‹¨ìˆœ ë Œë”
export async function getServerSideProps() {
  return { props: {} };
}

```

---

### 4) pages/mypage.js (SSR ê°•ì œ ë³´í˜¸: ë¹„ë¡œê·¸ì¸ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸)

```javascript
// pages/mypage.js
// ë§ˆì´í˜ì´ì§€ëŠ” SSRì—ì„œ ê°•ì œ ë³´í˜¸: ì¸ì¦ ì—†ìœ¼ë©´ /loginìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
// CSRì—ì„œë„ ë§ˆìš´íŠ¸ í›„ /auth/meë¡œ ì¬í™•ì¸í•˜ì—¬ ìƒíƒœ ë¶ˆì¼ì¹˜ ë°©ì§€

import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  Card, Avatar, Spin, Descriptions, Form, Input, Button, Upload, List, Tabs,
} from "antd";
import { UploadOutlined } from "@ant-design/icons";
import Link from "next/link";
import { useRouter } from "next/router";
import {
  updateNicknameRequest,
  updateProfileImageRequest,
  loginSuccess,
  logout,
} from "../reducers/authReducer";
import {
  loadFollowersRequest,
  loadFollowingsRequest,
  unfollowRequest,
  updateBlockRequest,
} from "../reducers/followReducer";
import api from "../api/axios";
import { wrapper } from "../store/configureStore";

const { TabPane } = Tabs;

function MyPage() {
  const dispatch = useDispatch();
  const router = useRouter();
  const { user, loading } = useSelector((state) => state.auth);
  const { followers = [], followings = [] } = useSelector((state) => state.follow);
  const [fileList, setFileList] = useState([]);

  // âœ… CSRì—ì„œ ì¸ì¦ ì¬í™•ì¸
  useEffect(() => {
    const verify = async () => {
      try {
        const me = await api.get("/auth/me");
        if (me?.data && me.data.nickname) {
          dispatch(loginSuccess({ user: me.data }));
        } else {
          dispatch(logout());
          router.replace("/login");
        }
      } catch {
        dispatch(logout());
        router.replace("/login");
      }
    };
    verify();
  }, [dispatch, router]);

  // âœ… íŒ”ë¡œì›Œ/íŒ”ë¡œì‰ ëª©ë¡
  useEffect(() => {
    if (user?.id) {
      dispatch(loadFollowersRequest({ followeeId: user.id }));
      dispatch(loadFollowingsRequest({ followerId: user.id }));
    }
  }, [user?.id, dispatch]);

  if (loading) return <Spin />;
  if (!user || !user.nickname) return <p>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>;

  const imageUrl = user?.ufile
    ? `${process.env.NEXT_PUBLIC_API_BASE_URL}/${user.ufile}`
    : undefined;

  return (
    <Card title="ë§ˆì´í˜ì´ì§€" style={{ maxWidth: 800, margin: "20px auto" }}>
      <Tabs defaultActiveKey="profile">
        <TabPane tab="ë‚´ ì •ë³´" key="profile">
          <div style={{ display: "flex", alignItems: "center", marginBottom: 20 }}>
            <Avatar src={imageUrl} size={64}>
              {user.nickname?.[0]}
            </Avatar>
            <Descriptions bordered column={1} size="middle" style={{ marginLeft: 20 }}>
              <Descriptions.Item label="ì´ë©”ì¼">{user.email}</Descriptions.Item>
              <Descriptions.Item label="ë‹‰ë„¤ì„">{user.nickname}</Descriptions.Item>
              <Descriptions.Item label="ê¶Œí•œ">{user.role}</Descriptions.Item>
            </Descriptions>
          </div>

          {/* ë‹‰ë„¤ì„ ìˆ˜ì • */}
          <Form
            onFinish={(values) =>
              dispatch(updateNicknameRequest({ userId: user.id, nickname: values.nickname }))
            }
            layout="inline"
            style={{ marginBottom: 20 }}
          >
            <Form.Item
              name="nickname"
              rules={[{ required: true, message: "ìƒˆ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" }]}
            >
              <Input placeholder="ìƒˆ ë‹‰ë„¤ì„" />
            </Form.Item>
            <Button type="primary" htmlType="submit">ë‹‰ë„¤ì„ ë³€ê²½</Button>
          </Form>

          {/* í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆ˜ì • */}
          <Form layout="inline" style={{ marginBottom: 20 }}>
            <Form.Item>
              <Upload
                beforeUpload={() => false}
                fileList={fileList}
                onChange={({ fileList }) => setFileList(fileList)}
                maxCount={1}
              >
                <Button icon={<UploadOutlined />}>ì´ë¯¸ì§€ ì„ íƒ</Button>
              </Upload>
            </Form.Item>
            <Button
              type="primary"
              onClick={() => {
                if (!user || fileList.length === 0) return;
                const file = fileList[0]?.originFileObj;
                dispatch(updateProfileImageRequest({ userId: user.id, file }));
              }}
            >
              í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½
            </Button>
          </Form>
        </TabPane>

        {/* íŒ”ë¡œì›Œ */}
        <TabPane tab="íŒ”ë¡œì›Œ" key="followers">
          <List
            dataSource={followers}
            renderItem={(item) => (
              <List.Item
                actions={[
                  <Button
                    key="unfollow"
                    onClick={() =>
                      dispatch(unfollowRequest({ followerId: user.id, followeeId: item.id }))
                    }
                  >
                    ì–¸íŒ”ë¡œìš°
                  </Button>,
                  <Button
                    key="block"
                    onClick={() =>
                      dispatch(updateBlockRequest({
                        followerId: user.id,
                        followeeId: item.id,
                        blocked: true,
                      }))
                    }
                  >
                    ì°¨ë‹¨
                  </Button>,
                ]}
              >
                <List.Item.Meta
                  avatar={<Avatar>{item.nickname?.[0]}</Avatar>}
                  title={item.nickname}
                  description={item.email}
                />
              </List.Item>
            )}
          />
          <Link href="/followers" passHref>
            <Button type="link">ì „ì²´ ë³´ê¸°</Button>
          </Link>
        </TabPane>

        {/* íŒ”ë¡œì‰ */}
        <TabPane tab="íŒ”ë¡œì‰" key="following">
          <List
            dataSource={followings}
            renderItem={(item) => (
              <List.Item
                actions={[
                  <Button
                    key="unfollow"
                    onClick={() =>
                      dispatch(unfollowRequest({ followerId: user.id, followeeId: item.id }))
                    }
                  >
                    ì–¸íŒ”ë¡œìš°
                  </Button>,
                  <Button
                    key="block"
                    onClick={() =>
                      dispatch(updateBlockRequest({
                        followerId: user.id,
                        followeeId: item.id,
                        blocked: true,
                      }))
                    }
                  >
                    ì°¨ë‹¨
                  </Button>,
                ]}
              >
                <List.Item.Meta
                  avatar={<Avatar>{item.nickname?.[0]}</Avatar>}
                  title={item.nickname}
                  description={item.email}
                />
              </List.Item>
            )}
          />
          <Link href="/followings" passHref>
            <Button type="link">ì „ì²´ ë³´ê¸°</Button>
          </Link>
        </TabPane>
      </Tabs>
    </Card>
  );
}

export default MyPage;

// âœ… SSR ê°•ì œ ë³´í˜¸: ì¸ì¦ ì‹¤íŒ¨ ì‹œ /loginìœ¼ë¡œ ì¦‰ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
export const getServerSideProps = wrapper.getServerSideProps((store) => async (ctx) => {
  const cookie = ctx.req.headers.cookie || "";
  try {
    const me = await api.get("/auth/me", { headers: { cookie } });
    if (me?.data && me.data.nickname) {
      store.dispatch(loginSuccess({ user: me.data }));
      return { props: {} };
    }
  } catch {
    // ì¸ì¦ ì‹¤íŒ¨ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  }
  return {
    redirect: { destination: "/login", permanent: false },
  };
});

```

---

### 5) src/pages/OAuth2Callback.js (ì†Œì…œ ë¡œê·¸ì¸ ì½œë°±, Accessë§Œ ì €ì¥)

```javascript
// src/pages/OAuth2Callback.js
// ì†Œì…œ ë¡œê·¸ì¸ OAuth2 ì½œë°±: ë°±ì—”ë“œê°€ accessë§Œ ì¿¼ë¦¬ë¡œ ì „ë‹¬, refreshëŠ” ì¿ í‚¤ë¡œ ë‚´ë ¤ì˜´
// â†’ Access Tokenë§Œ ì €ì¥í•˜ê³  í™ˆ/ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™

import React, { useEffect } from "react";
import { useRouter } from "next/router";

export default function OAuth2Callback() {
  const router = useRouter();

  useEffect(() => {
    if (typeof window === "undefined") return;
    const params = new URLSearchParams(window.location.search);
    const accessToken = params.get("access");

    if (accessToken) {
      localStorage.setItem("accessToken", accessToken);
      router.replace("/mypage");
    } else {
      router.replace("/login");
    }
  }, [router]);

  return (
    <div>
      <h2>ì†Œì…œ ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...</h2>
      <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
    </div>
  );
}
```

---
# 6. Layout.js

```js
// components/AppLayout.js
// Ant Design Layout, Menu ë¶ˆëŸ¬ì˜¤ê¸°
import { Layout, Menu } from "antd";
// Next.js Link ì»´í¬ë„ŒíŠ¸
import Link from "next/link";
// Redux ìƒíƒœ ì¡°íšŒ ë° ì•¡ì…˜ dispatch
import { useSelector, useDispatch } from "react-redux";
// axios ì¸ìŠ¤í„´ìŠ¤
import axios from "../api/axios";
// Redux ì•¡ì…˜
import { logout, loginSuccess } from "../reducers/authReducer";
// Next.js Router
import { useRouter } from "next/router";
// React useEffect
import { useEffect } from "react";

const { Header, Content } = Layout;

function AppLayout({ children, initialUser }) {
  const { user } = useSelector((state) => state.auth); // Reduxì—ì„œ user ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
  const dispatch = useDispatch();
  const router = useRouter();

  // âœ… SSRì—ì„œ ë‚´ë ¤ì¤€ userë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë°˜ì˜
  useEffect(() => {
    if (initialUser && !user && initialUser.nickname) {
      dispatch(loginSuccess({ user: initialUser }));
    }
  }, [initialUser, user, dispatch]);

  // âœ… CSR ë³´ì™„ í˜¸ì¶œ ì¡°ê±´ ëª…í™•í™” â†’ SSRì—ì„œ userê°€ ì—†ì„ ë•Œë§Œ ì‹¤í–‰
  useEffect(() => {
    if (!user && !initialUser) {
      axios
        .get("/auth/me")
        .then((res) => {
          if (res.data && res.data.nickname) {
            dispatch(loginSuccess({ user: res.data }));
          } else {
            dispatch(logout());
          }
        })
        .catch(() => {
          dispatch(logout());
        });
    }
  }, [user, initialUser, dispatch]);

  const handleLogout = async () => {
    try {
      await axios.post("/auth/logout"); // âœ… ì¿ í‚¤ ê¸°ë°˜ ë¡œê·¸ì•„ì›ƒ
      // âœ… Access Token ì œê±°
      if (typeof window !== "undefined") {
        localStorage.removeItem("accessToken");
      }
      dispatch(logout()); // Redux ìƒíƒœ ì´ˆê¸°í™”
      router.push("/login"); // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    } catch (err) {
      console.error("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:", err);
      dispatch(logout());
      router.push("/login");
    }
  };

  // âœ… Ant Design Menu items ë°©ì‹ìœ¼ë¡œ ë³€ê²½
  const menuItems = [
    { key: "home", label: <Link href="/">Home</Link> },
    ...(user && user.nickname
      ? [
          // --- ì „ì—­ ê¸°ëŠ¥: ê¸€ì“°ê¸°, í•´ì‹œíƒœê·¸ ê²€ìƒ‰ ---
          { key: "new", label: <Link href="/posts/new">ê¸€ì“°ê¸°</Link> },
          { key: "hashtags", label: <Link href="/hashtags">í•´ì‹œíƒœê·¸</Link> },

          // --- ê°œì¸ ì •ë³´/ê´€ê³„ ê´€ë¦¬ ---
          { key: "profile", label: <Link href="/mypage">Mypage</Link> },
          { key: "followers", label: <Link href="/followers">Followers</Link> },
          { key: "following", label: <Link href="/followings">Followings</Link> },

          // --- ë¡œê·¸ì•„ì›ƒ ---
          {
            key: "logout",
            label: (
              <a onClick={handleLogout} style={{ cursor: "pointer" }}>
                Logout
              </a>
            ),
          },
        ]
      : [
          { key: "login", label: <Link href="/login">Login</Link> },
          { key: "signup", label: <Link href="/signup">Signup</Link> },
        ]),
  ];

  return (
    <Layout>
      <Header>
        <Menu theme="dark" mode="horizontal" items={menuItems} />
      </Header>
      <Content style={{ padding: "20px" }}>{children}</Content>
    </Layout>
  );
}

export default AppLayout;

```
